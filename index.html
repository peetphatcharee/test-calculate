<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>ระบบคำนวณซื้อปลา</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      table {
        margin-top: 10px;
        border-collapse: collapse;
      }
      th, td {
        padding: 5px 10px;
        border: 1px solid #aaa;
      }
      .expired {
        color: red;
      }
    </style>
    <script src="script.js"></script>
  </head>
  <body>
    <h2>ระบบคำนวณซื้อปลา</h2>
    <label>จำนวนเงินที่มี (บาท): </label>
    <input type="number" id="inputValue" />
    <button onclick="calculate()" id="calculate">คำนวณ</button>

    <table >
      <thead>
        <tr>
          <th>ชนิดปลา</th>
          <th>จำนวนที่ซื้อได้</th>
          <th>จำนวนเงิน</th>
          <th>ส่วนลด</th>
          <th>วันหมดอายุ</th>
        </tr>
      </thead>
      <tbody id="resultBody"></tbody>
    </table>
<div id="resultTotal"></div>
    <!-- <p>ยอดรวมทั้งหมด: <span id="total">0</span> บาท</p>
    <p>รวมส่วนลด: <span id="discount">0</span> บาท</p>
    <p>ยอดสุทธิ: <span id="net">0</span> บาท</p>
    <p>เงินทอน: <span id="change">0</span> บาท</p> -->

    <!-- <script>
      const fishes = [
        { name: "ปลาแซลม่อน", detail: { price: 50, quantity: 4, expired: "2025-08-30T00:00:00" } },
        { name: "ปลาช่อน", detail: { price: 10, quantity: 5, expired: "2025-08-23T00:00:00" } },
        { name: "ปลาทู", detail: { price: 5, quantity: 5, expired: "2025-08-24T00:00:00" } },
        { name: "ปลานิล", detail: { price: 20, quantity: 5, expired: "2025-08-20T00:00:00" } },
        { name: "ปลาหมอ", detail: { price: 1, quantity: 10, expired: "2025-08-21T00:00:00" } },
      ];

      function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString("th-TH");
      }

      function calculatePurchase() {
        let cash = parseFloat($("#cash").val());
        if (isNaN(cash) || cash <= 0) {
          alert("กรุณากรอกจำนวนเงินให้ถูกต้อง");
          return;
        }

        let remaining = cash;
        let total = 0;
        let discount = 0;
        let rows = "";
        let salmonCount = 0;

        const validFish = fishes
          .filter(f => new Date(f.detail.expired) >= new Date())
          .sort((a, b) => b.detail.price - a.detail.price);

        validFish.forEach(fish => {
          const price = fish.detail.price;
          const qtyAvailable = fish.detail.quantity;

          let buyQty = Math.min(Math.floor(remaining / price), qtyAvailable);
          let itemTotal = buyQty * price;
          let itemDiscount = 0;

          if (fish.name.includes("แซลม่อน") && buyQty >= 2) {
            itemDiscount = 20;
            discount += itemDiscount;
          }

          total += itemTotal;
          remaining -= itemTotal;

          rows += `
            <tr>
              <td>${fish.name}</td>
              <td>${buyQty}</td>
              <td>${itemTotal} บาท</td>
              <td>${itemDiscount > 0 ? itemDiscount + " บาท" : "0 บาท"}</td>
              <td>${formatDate(fish.detail.expired)}</td>
            </tr>
          `;
        });

        const net = total - discount;
        const change = cash - net;

        $("#fish-list").html(rows);
        $("#total").text(total);
        $("#discount").text(discount);
        $("#net").text(net);
        $("#change").text(change >= 0 ? change : 0);
      }

      $("#calculate").on("click", calculatePurchase);
    </script> -->
  </body>
</html>
